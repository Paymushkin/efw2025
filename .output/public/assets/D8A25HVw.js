import{s as V}from"./x_rD_Ya3.js";import{_ as O,e as g,f as T,g as U,q as $,c as d,o as u,a as c,t as _,F as q,r as M,n as j,l as B}from"./CDyz5yYI.js";const G={class:"approved-companies-list"},W={key:0,class:"text-center py-8"},z={key:1,class:"text-center py-8"},F={class:"text-red-600"},Q={key:2,class:"text-center py-8"},Y={key:3,class:"space-y-3"},H={class:"text-lg font-semibold mb-4"},J={class:"space-y-3 pr-2"},K={class:"flex items-center gap-3 flex-1"},X={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},Z={class:"flex-1"},ee={class:"flex items-center gap-2"},te={class:"font-medium text-gray-900"},se={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},oe={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(ne,{expose:N,emit:P}){const a=g([]),h=g(!0),m=g(""),p=g(null),b=g(null),R=n=>{if(!n||n.length<=2)return n;const e=n.split(" ");if(e.length===1){const s=e[0];if(s.length<5){const t=Math.max(0,s.length-2);return s.substring(0,2)+"*".repeat(t)}else{const t=Math.max(0,s.length-5);return s.substring(0,2)+"*".repeat(t)+s.substring(s.length-3)}}else return e.map((t,r)=>{if(r===0){const i=Math.max(0,t.length-2);return t.substring(0,2)+"*".repeat(i)}else return r===e.length-1&&t.length===3?t:"*".repeat(t.length)}).join(" ")},D=n=>n?n.companyName+"_"+n.timestamp===p.value:!1,x=n=>n.filter(s=>s.status==="APPROVED"||s.status==="approved"||s.status==="Approved"),C=async()=>{try{if(h.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const e=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(e.success){const t=x(e.companies).sort((r,i)=>new Date(i.timestamp)-new Date(r.timestamp));if(p.value){const r=a.value.findIndex(i=>i.companyName+"_"+i.timestamp===p.value);if(r!==-1){const i=a.value.splice(r,1)[0];t.unshift(i)}}a.value=t,v("companies-count-updated",a.value.length)}else m.value=e.error||"Ошибка загрузки данных"}catch(e){console.error("API Error:",e),a.value=[],v("companies-count-updated",0),m.value="Сервис временно недоступен"}h.value=!1}else{try{const t=await fetch("https://docs.google.com/spreadsheets/d/1jGEJIU-0Cwx151O0JczBkoaUCE48j5saab-R5eKzLfM/export?format=csv&gid=0");if(!t.ok)throw new Error(`CSV export error: ${t.statusText}`);const E=(await t.text()).split(`
`).filter(o=>o.trim()).map(o=>{const l=[];let f="",I=!1;for(let k=0;k<o.length;k++){const A=o[k];A==='"'?I=!I:A===","&&!I?(l.push(f.trim()),f=""):f+=A}return l.push(f.trim()),l}).map((o,l)=>({timestamp:o[0]||"",companyName:o[1]||"",industry:o[2]||"",name:o[3]||"",email:o[4]||"",phone:o[5]||"",message:o[6]||"",agreement1:o[7]||"",agreement2:o[8]||"",ipAddress:o[9]||"",userAgent:o[10]||"",status:o[11]||"WAITLIST"})).filter(o=>o.companyName),y=x(E),L=y.sort((o,l)=>new Date(l.timestamp)-new Date(o.timestamp));if(p.value){const o=a.value.findIndex(l=>l.companyName+"_"+l.timestamp===p.value);if(o!==-1){const l=a.value.splice(o,1)[0];L.unshift(l)}}a.value=L,v("companies-count-updated",a.value.length),console.log("Approved companies loaded from Google Sheets:",y.length)}catch(e){console.error("CSV fetch error:",e),m.value="Ошибка загрузки данных"}h.value=!1}}catch(n){console.error("Error fetching approved companies:",n),m.value="Ошибка загрузки данных",h.value=!1}},S=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const e=await $fetch("/api/companies-list",{query:{_t:Date.now()}});if(e.success){const t=x(e.companies).sort((r,i)=>new Date(i.timestamp)-new Date(r.timestamp));a.value=t,v("companies-count-updated",a.value.length)}}catch(e){console.error("API Error in auto refresh:",e)}else{const e="https://script.google.com/macros/s/AKfycbxUuh8iEc5YE8k2q5e36DE66OpYPetpEOA0YdpQm0QwRXqqEcBDPcU5xP0RZI71R-bsbA/exec",s="callback_approved_auto_"+Date.now();window[s]=r=>{if(r&&r.success){const w=x(r.companies).sort((E,y)=>new Date(y.timestamp)-new Date(E.timestamp));a.value=w,v("companies-count-updated",a.value.length)}delete window[s],document.head.removeChild(t)};const t=document.createElement("script");t.src=`${e}?action=getCompanies&callback=${s}&_t=${Date.now()}`,document.head.appendChild(t)}}catch(n){console.error("Error in auto refresh:",n)}};N({refresh:(n=null)=>{n&&(p.value=n.companyName+"_"+n.timestamp),C()},fetchCompanies:C});const v=P;return T(()=>{C(),b.value=V(S,3e4)}),U(()=>{b.value&&clearInterval(b.value)}),$(p,n=>{n&&setTimeout(()=>{p.value=null},5e3)}),(n,e)=>(u(),d("div",G,[h.value?(u(),d("div",W,e[0]||(e[0]=[c("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",z,[c("p",F,"Loading error: "+_(m.value),1)])):a.value.length===0?(u(),d("div",Q,e[1]||(e[1]=[c("p",{class:"text-gray-600"},"No approved companies yet",-1)]))):(u(),d("div",Y,[c("h3",H,"APPROVED COMPANIES ("+_(a.value.length)+")",1),c("div",J,[(u(!0),d(q,null,M(a.value,(s,t)=>(u(),d("div",{key:t,class:j(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",D(s)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[c("div",K,[c("div",X,_(t+1),1),c("div",Z,[c("div",ee,[c("div",te,_(R(s.companyName))+_(s.industry?" | "+s.industry:""),1),D(s)?(u(),d("span",se," NEW ")):B("",!0),e[2]||(e[2]=c("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},le=O(oe,[["__scopeId","data-v-24ef27cd"]]);export{le as A};
