import{s as I}from"./x_rD_Ya3.js";import{_ as A,f as g,g as L,h as N,x as D,c as d,o as u,a as i,t as _,F as G,r as R,n as O,e as P}from"./_Ivncu3a.js";const j={class:"approved-companies-list"},T={key:0,class:"text-center py-8"},U={key:1,class:"text-center py-8"},W={class:"text-red-600"},V={key:2,class:"text-center py-8"},$={key:3,class:"space-y-3"},B={class:"text-lg font-semibold mb-4"},F={class:"space-y-3 pr-2"},K={class:"flex items-center gap-3 flex-1"},S={class:"flex-shrink-0 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-xs font-medium text-white"},Y={class:"flex-1"},q={class:"flex items-center gap-2"},H={class:"font-medium text-gray-900"},J={key:0,class:"px-2 py-1 text-xs font-semibold text-green-700 bg-green-100 rounded-full"},M={__name:"ApprovedCompaniesList",emits:["companies-count-updated"],setup(Q,{expose:C,emit:y}){const a=g([]),h=g(!0),m=g(""),c=g(null),x=g(null),k=n=>{if(!n||n.length<=2)return n;const e=n.split(" ");if(e.length===1){const t=e[0];return t.length<5?t.substring(0,2)+"*".repeat(t.length-2):t.substring(0,2)+"*".repeat(t.length-5)+t.substring(t.length-3)}else return e.map((o,s)=>s===0?o.substring(0,2)+"*".repeat(o.length-2):s===e.length-1&&o.length===3?o:"*".repeat(o.length)).join(" ")},w=n=>n?n.companyName+"_"+n.timestamp===c.value:!1,b=async()=>{try{if(h.value=!0,m.value="",window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0")){try{const e=await $fetch("/api/companies-list");if(e.success){const o=e.companies.filter(s=>s.status==="approved"||s.status==="Approved").sort((s,l)=>new Date(l.timestamp)-new Date(s.timestamp));if(c.value){const s=a.value.findIndex(l=>l.companyName+"_"+l.timestamp===c.value);if(s!==-1){const l=a.value.splice(s,1)[0];o.unshift(l)}}a.value=o,v("companies-count-updated",a.value.length)}else m.value=e.error||"Ошибка загрузки данных"}catch(e){console.error("API Error:",e),a.value=[],v("companies-count-updated",0),m.value="Сервис временно недоступен"}h.value=!1}else{const e="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",t="callback_approved_companies_"+Date.now();window[t]=s=>{if(s&&s.success){const f=s.companies.filter(r=>r.status==="approved"||r.status==="Approved").sort((r,p)=>new Date(p.timestamp)-new Date(r.timestamp));if(c.value){const r=a.value.findIndex(p=>p.companyName+"_"+p.timestamp===c.value);if(r!==-1){const p=a.value.splice(r,1)[0];f.unshift(p)}}a.value=f,v("companies-count-updated",a.value.length)}else m.value=s.error||"Ошибка загрузки данных";h.value=!1,delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(n){console.error("Error fetching approved companies:",n),m.value="Ошибка загрузки данных",h.value=!1}},E=async()=>{try{if(window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes("0.0.0.0"))try{const e=await $fetch("/api/companies-list");if(e.success){const o=e.companies.filter(s=>s.status==="approved"||s.status==="Approved").sort((s,l)=>new Date(l.timestamp)-new Date(s.timestamp));a.value=o,v("companies-count-updated",a.value.length)}}catch(e){console.error("API Error in auto refresh:",e)}else{const e="https://script.google.com/macros/s/AKfycbxbWqpE_TR7HJoClggVpGBYdUGcssKxWOpbFAa7nZGQp69jrE0hUxLiiCx5nY8T_x70jg/exec",t="callback_approved_auto_"+Date.now();window[t]=s=>{if(s&&s.success){const f=s.companies.filter(r=>r.status==="approved"||r.status==="Approved").sort((r,p)=>new Date(p.timestamp)-new Date(r.timestamp));a.value=f,v("companies-count-updated",a.value.length)}delete window[t],document.head.removeChild(o)};const o=document.createElement("script");o.src=`${e}?action=getCompanies&callback=${t}`,document.head.appendChild(o)}}catch(n){console.error("Error in auto refresh:",n)}};C({refresh:(n=null)=>{n&&(c.value=n.companyName+"_"+n.timestamp),b()},fetchCompanies:b});const v=y;return L(()=>{b(),x.value=I(E,3e4)}),N(()=>{x.value&&clearInterval(x.value)}),D(c,n=>{n&&setTimeout(()=>{c.value=null},5e3)}),(n,e)=>(u(),d("div",j,[h.value?(u(),d("div",T,e[0]||(e[0]=[i("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black"},null,-1)]))):m.value?(u(),d("div",U,[i("p",W,"Ошибка загрузки: "+_(m.value),1)])):a.value.length===0?(u(),d("div",V,e[1]||(e[1]=[i("p",{class:"text-gray-600"},"Пока нет одобренных компаний",-1)]))):(u(),d("div",$,[i("h3",B,"!APPROVED COMPANIES ("+_(a.value.length)+")",1),i("div",F,[(u(!0),d(G,null,R(a.value,(t,o)=>(u(),d("div",{key:o,class:O(["flex items-center justify-between p-3 rounded-lg border transition-all duration-300",w(t)?"bg-green-50 border-green-200 shadow-md":"bg-blue-50 border-blue-200"])},[i("div",K,[i("div",S,_(o+1),1),i("div",Y,[i("div",q,[i("div",H,_(k(t.companyName))+_(t.industry?" | "+t.industry:""),1),w(t)?(u(),d("span",J," NEW ")):P("",!0),e[2]||(e[2]=i("span",{class:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full"}," APPROVED ",-1))])])])],2))),128))])]))]))}},te=A(M,[["__scopeId","data-v-63840bec"]]);export{te as A};
