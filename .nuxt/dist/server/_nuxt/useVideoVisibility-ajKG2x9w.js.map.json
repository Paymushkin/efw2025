{"file":"useVideoVisibility-ajKG2x9w.js","mappings":";AAEO,SAAS,qBAAqB;AACnC,QAAM,YAAY,IAAI,CAAA,CAAE;AACxB,QAAM,YAAY,IAAI,CAAA,CAAE;AACxB,QAAM,YAAY,IAAI,CAAA,CAAE;AAExB,QAAM,mBAAmB,CAAC,UAAU,CAAC,YAAY;AAC/C,YAAQ,QAAQ,CAAC,UAAU;AACzB,YAAM,QAAQ,UAAU,MAAM,KAAK;AACnC,UAAI,MAAM,WAAW,OAAO;AAC1B,kBAAU,MAAM,KAAK,IAAI,MAAM;AAE/B,YAAI,MAAM,gBAAgB;AACxB,iBAAO,OAAO,MAAM,MAAM;AAAA,UAE1B,CAAC;AAAA,QACH,OAAO;AACL,iBAAO,MAAK;AAAA,QACd;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH;AAEA,QAAM,eAAe,CAAC,UAAU;AAC9B,UAAM,QAAQ,UAAU,MAAM,KAAK;AACnC,QAAI,SAAS,CAAC,UAAU,MAAM,KAAK,GAAG;AACpC,YAAM,WAAW,IAAI,qBAAqB,iBAAiB,KAAK,GAAG;AAAA,QACjE,WAAW;AAAA,MACnB,CAAO;AACD,eAAS,QAAQ,KAAK;AACtB,gBAAU,MAAM,KAAK,IAAI;AAAA,IAC3B;AAAA,EACF;AAEA,QAAM,iBAAiB,CAAC,UAAU;AAChC,UAAM,WAAW,UAAU,MAAM,KAAK;AACtC,QAAI,UAAU;AACZ,eAAS,WAAU;AACnB,aAAO,UAAU,MAAM,KAAK;AAAA,IAC9B;AAAA,EACF;AAEA,QAAM,cAAc,CAAC,IAAI,UAAU;AACjC,QAAI,IAAI;AACN,gBAAU,MAAM,KAAK,IAAI;AACzB,mBAAa,KAAK;AAAA,IACpB,OAAO;AACL,qBAAe,KAAK;AACpB,aAAO,UAAU,MAAM,KAAK;AAAA,IAC9B;AAAA,EACF;AAEA,QAAM,UAAU,MAAM;AACpB,WAAO,KAAK,UAAU,KAAK,EAAE,QAAQ,cAAc;AACnD,cAAU,QAAQ,CAAA;AAClB,cAAU,QAAQ,CAAA;AAClB,cAAU,QAAQ,CAAA;AAAA,EACpB;AAEA,SAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AACA;","names":[],"sources":["../../../../composables/useVideoVisibility.js"],"sourcesContent":["import { ref, watch } from 'vue'\n\nexport function useVideoVisibility() {\n  const videoRefs = ref({})\n  const observers = ref({})\n  const isVisible = ref({})\n\n  const handleVisibility = (index) => (entries) => {\n    entries.forEach((entry) => {\n      const video = videoRefs.value[index]\n      if (entry.target === video) {\n        isVisible.value[index] = entry.isIntersecting\n        \n        if (entry.isIntersecting) {\n          video?.play().catch(() => {\n            // Игнорируем ошибку автовоспроизведения\n          })\n        } else {\n          video?.pause()\n        }\n      }\n    })\n  }\n\n  const observeVideo = (index) => {\n    const video = videoRefs.value[index]\n    if (video && !observers.value[index]) {\n      const observer = new IntersectionObserver(handleVisibility(index), {\n        threshold: 0.5\n      })\n      observer.observe(video)\n      observers.value[index] = observer\n    }\n  }\n\n  const unobserveVideo = (index) => {\n    const observer = observers.value[index]\n    if (observer) {\n      observer.disconnect()\n      delete observers.value[index]\n    }\n  }\n\n  const setVideoRef = (el, index) => {\n    if (el) {\n      videoRefs.value[index] = el\n      observeVideo(index)\n    } else {\n      unobserveVideo(index)\n      delete videoRefs.value[index]\n    }\n  }\n\n  const cleanup = () => {\n    Object.keys(observers.value).forEach(unobserveVideo)\n    videoRefs.value = {}\n    observers.value = {}\n    isVisible.value = {}\n  }\n\n  return {\n    setVideoRef,\n    cleanup,\n    isVisible\n  }\n} "],"version":3}