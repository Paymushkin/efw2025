<template>
  <div>
    <AppSeo
      title="AI Advertising Contest - Emirates Fashion Week Dubai 2025"
      description="Join the AI Advertising Contest for Emirates Fashion Week Spring/Summer 2025/2026. Create Instagram Reels and Stories using AI tools. Win prizes and contracts!"
      keywords="AI Advertising Contest, Emirates Fashion Week, Dubai Fashion Event, AI tools, Instagram Reels, Fashion Week 2025"
    />

    <div class="container mx-auto px-4 py-8">
      <!-- Секция 1: Заголовок и описание -->
      <section class="md:mb-[76px] mb-[56px]">
        <h1 class="text-2xl md:text-4xl lg:text-5xl font-bold mb-8 text-left">
          Emirates Fashion Week – AI Advertising Contest
        </h1>

        <div class="max-w-4xl">
          <p class="text-sm md:text-base xl:text-lg leading-relaxed text-left">
            We are excited to launch the <strong>AI Advertising Contest</strong> for the upcoming 
            <strong>14th&nbspEmirates Fashion Week, Spring/Summer&nbsp2025/2026</strong>,<br> taking place
            <strong>8–1&nbsp1&nbsp;November&nbsp;2025 in&nbsp;Dubai</strong>.
          </p>
        </div>
      </section>

      <!-- Секция 3: Информационные блоки -->
      <section class="md:mb-[76px] mb-[56px]">
        <h2 class="text-2xl md:text-3xl font-bold text-left mb-8">TERMS</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          
          <!-- Блок 1: Who can participate? -->
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-base md:text-xl xl:text-2xl font-bold mb-4">Who can participate</h3>
            <p class="text-sm md:text-base xl:text-lg mb-4">
              Anyone, anywhere. Use <strong>any AI tools</strong> to create <strong>Instagram Reels/Stories</strong> (video-editing allowed).
            </p>
            
            <h4 class="text-sm md:text-base xl:text-lg font-semibold mb-2"><strong>Requirements</strong></h4>
            <ul class="text-sm md:text-base xl:text-lg space-y-2">
              <li>• <strong>Format:</strong> 9:16 vertical</li>
              <li>• <strong>Duration:</strong> any for Reels/Stories</li>
              <li>• <strong>Must include date & EFW brand:</strong> <strong>8–11&nbsp;November&nbsp;2025, Dubai&nbsp;+ Emirates&nbsp;Fashion&nbsp;Week</strong> (<a 
                href="https://storage.yandexcloud.net/videos-meyou/efw2025/ai/DrSugiyama-Regular.ttf"
                download="DrSugiyama-Regular.ttf"
                class="text-blue-600 hover:text-blue-800 underline font-semibold"
              >
                Dr&nbsp;Sugiyama
              </a>&nbsp;preferred)</li>
            </ul>
          </div>

          <!-- Блок 2: How to submit -->
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-base md:text-xl xl:text-2xl font-bold mb-4">How to submit</h3>
            <ol class="text-sm md:text-base xl:text-lg space-y-2 mb-4">
              <li>1. Post your Reels/Story on your Instagram.</li>
              <li>2. Tag <a 
                href="https://instagram.com/emirates_fashionweek" 
                target="_blank"
                class="text-blue-600 hover:text-blue-800 underline"
              >
                @emirates_fashionweek
              </a> (not a collaboration—just a tag).</li>
              <li>3. Entries <strong>accepted only if reposted</strong> by our official account.</li>
            </ol>
            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-400">
              <h4 class="text-sm md:text-base xl:text-lg font-semibold text-yellow-800 mb-2"><strong>Fake Account Alert</strong></h4>
              <p class="text-sm md:text-base xl:text-lg text-yellow-700">
                We detected a <strong>fake account</strong> using our name and unclear activity. Tag <strong>only</strong> the official: <a 
                  href="https://instagram.com/emirates_fashionweek" 
                  target="_blank"
                  class="text-blue-600 hover:text-blue-800 underline font-semibold"
                >
                  @emirates_fashionweek
                </a> (black logo + blue verified sign).
              </p>
            </div>
          </div>

          <!-- Блок 3: Optional -->
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-base md:text-xl xl:text-2xl font-bold mb-4">Optional</h3>
            <ul class="text-sm md:text-base xl:text-lg space-y-2">
              <li>• May use past EFW looks/highlights <a href="https://emiratesfashionweeks.com/gallery" class="text-blue-600 underline" target="_blank">Gallery</a> and designers' looks.</li>
              <li>• May use program note: <strong>8–9&nbsp;Nov</strong> Catwalk&nbsp;Runway · <strong>10–11&nbsp;Nov</strong> Pop-up&nbsp;Market (Beauty&nbsp;& Wellness).</li>
              <li>• <strong>Face of EFW:</strong> you may use faces listed in the authorized pool; the list will expand over time.</li>
              <li>• <strong>Reference assets below:</strong> venue/location photos and Faces of EFW images are provided as <strong>optional</strong> references. <strong>You do not have to use any or all</strong> of them — your creativity is not restricted.</li>
            </ul>
          </div>

          <!-- Блок 4: Prizes -->
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-base md:text-xl xl:text-2xl font-bold mb-4">Prizes (Prize Stack)</h3>
            <p class="text-sm md:text-base xl:text-lg mb-3">Winners may receive:</p>
            <ul class="text-sm md:text-base xl:text-lg space-y-2">
              <li>• <strong>Contract</strong> for ongoing AI ads with Emirates Fashion Week.</li>
              <li>• <strong>Annual AI-tool fee coverage:</strong> $500 / $200 / $100.</li>
              <li>• <strong>Official recommendation letters</strong> confirming use in EFW media.</li>
              <li>• <strong>Potential paid contracts</strong> with participating designers (up to <strong>40</strong>) for AI ads of their looks.</li>
              <li>• <strong>Screening</strong> on giant LED screens during Fashion Week.</li>
              <li>• <strong>LinkedIn-ready badge</strong> confirming participation in the EFW campaign.</li>
              <li>• <strong>Featured website gallery</strong> with credits and links.</li>
            </ul>
          </div>

          <!-- Блок 5: Open Calls (Partners Welcome) -->
          <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h3 class="text-base md:text-xl xl:text-2xl font-bold mb-4">Open Calls (Partners Welcome)</h3>
            <ul class="text-sm md:text-base xl:text-lg space-y-3">
              <li>• <strong>Brands:</strong> We invite product brands to supply product images/packshots and brand assets for creators to integrate into their AI ads; in return, please contribute additional prizes for creators. (Assets must be cleared for contest-limited use; brand retains IP.)</li>
              <li>• <strong>AI Platforms:</strong> We welcome AI-generation companies to provide creator credits/vouchers for participants.</li>
              <li>• <strong>Celebrities / Stylists / Designers:</strong> If you're willing to opt in your likeness, we'll add you to the authorized Face of EFW pool for use within this contest.</li>
            </ul>
          </div>

          
        </div>
      </section>

      <!-- Секция 2: FOOTNOTE / LEGAL -->
      <section class="md:mb-[76px] mb-[56px]">
        <h2 class="text-2xl md:text-3xl font-bold text-left mb-8">FOOTNOTE / LEGAL</h2>
        
        <div class="bg-gray-50 rounded-2xl p-6">
          <ul class="text-sm md:text-base xl:text-lg space-y-3 text-gray-700">
            <li>• Content must be respectful and lawful; no defamatory, misleading, hateful, political, or privacy-invasive content.</li>
            <li>• No deepfake "statements" or fabricated claims of endorsement/partnership by individuals or brands.</li>
            <li>• Face of EFW images may be used only from the authorized pool published on EFW channels; attribution will be provided where applicable.</li>
            <li>• By submitting, you grant EFW a non-exclusive, revocable license to repost, screen at the event, and feature your work with credit; you retain IP.</li>
            <li>• The Face of EFW list will expand over time; check updates before publishing.</li>
          </ul>
        </div>
      </section>

      <!-- Секция 7: FACES of EFW -->
      <FacesOfEfwSection />

      <!-- Секция 3: Reels -->
      <section class="md:mb-[76px] mb-[56px]">
        
        <!-- Instagram Reels из Google Sheets -->
         <div v-if="instagramReels.length > 0" >
          <h2 class="text-2xl md:text-3xl font-bold text-left mb-8">CREATOR SHOWCASES</h2>
           
           <!-- Мобильная версия: горизонтальный скролл -->
           <div class="lg:hidden">
             <div class="flex overflow-x-auto hide-scrollbar -mx-4 px-4 gap-2">
               <div 
                 v-for="(reel, index) in instagramReels" 
                 :key="index"
                 class="flex-shrink-0"
               >
                 <div class="bg-white rounded-2xl h-[500px] flex flex-col">
                   <!-- Instagram Embed 9:16 -->
                   <div class="flex-1 flex items-center justify-center">
                     <blockquote 
                       class="instagram-media" 
                       :data-instgrm-permalink="reel" 
                       data-instgrm-version="14" 
                       style="background:#FFF; border:0; border-radius:12px; margin: 0; padding:0; width:100%; height:400px;"
                     >
                       <div style="padding:0; height:100%; display:flex; align-items:center; justify-content:center;">
                         <a 
                           :href="reel" 
                           style="background:#FFFFFF; line-height:0; padding:0; text-align:center; text-decoration:none; width:100%; height:100%; display:flex; align-items:center; justify-content:center;" 
                           target="_blank"
                         >
                         </a>
                       </div>
                     </blockquote>
                   </div>
                 </div>
               </div>
             </div>
           </div>

           <!-- Десктопная версия: карусель -->
           <div class="hidden lg:block relative">
             <!-- Контейнер карусели -->
             <div class="overflow-hidden">
               <div 
                 class="flex transition-transform duration-500 ease-in-out"
                 :style="{ transform: `translateX(-${currentReelIndex * (100 / visibleReels)})` }"
               >
                 <div 
                   v-for="(reel, index) in instagramReels" 
                   :key="index"
                   class="flex-shrink-0"
                   :style="{ width: `${100 / visibleReels}%` }"
                 >
                     <div class="bg-white rounded-2xl p-4 mx-4 flex flex-col h-[600px]">
                       <!-- Instagram Embed 9:16 -->
                       <div class="flex-1 flex items-center justify-center">
                         <blockquote 
                           class="instagram-media" 
                           :data-instgrm-permalink="reel" 
                           data-instgrm-version="14" 
                           style="background:#FFF; border:0; border-radius:12px; margin: 0; padding:0; width:100%; max-width:320px; height:500px;"
                         >
                           <div style="padding:0; height:100%; display:flex; align-items:center; justify-content:center;">
                             <a 
                               :href="reel" 
                               style="background:#FFFFFF; line-height:0; padding:0; text-align:center; text-decoration:none; width:100%; height:100%; display:flex; align-items:center; justify-content:center;" 
                               target="_blank"
                             >
                             </a>
                           </div>
                         </blockquote>
                       </div>
                     </div>
                 </div>
               </div>
             </div>

             <!-- Навигационные стрелки -->
             <button 
               v-if="instagramReels.length > visibleReels"
               @click="stopAutoPlay(); prevReel()"
               class="absolute left-0 top-1/2 transform -translate-y-1/2 -translate-x-4 bg-white/80 hover:bg-white rounded-full p-2 shadow-lg transition-all duration-200 z-10"
             >
               <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
               </svg>
             </button>
             
             <button 
               v-if="instagramReels.length > visibleReels"
               @click="stopAutoPlay(); nextReel()"
               class="absolute right-0 top-1/2 transform -translate-y-1/2 translate-x-4 bg-white/80 hover:bg-white rounded-full p-2 shadow-lg transition-all duration-200 z-10"
             >
               <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
               </svg>
             </button>

             <!-- Индикаторы -->
             <div v-if="instagramReels.length > visibleReels" class="flex justify-center mt-6 space-x-2">
               <button
                 v-for="(page, index) in totalPages"
                 :key="index"
                 @click="stopAutoPlay(); goToPage(index)"
                 class="w-3 h-3 rounded-full transition-all duration-200"
                 :class="index === currentPage ? 'bg-gray-800' : 'bg-gray-300 hover:bg-gray-400'"
               ></button>
             </div>
           </div>
         </div>
      </section>

      <!-- Секция 4: Галерея изображений -->
      <section class="md:mb-[76px] mb-[56px]">
        <h2 class="text-2xl md:text-3xl font-bold text-left mb-8">OPTIONAL REFERENCE GALLERY</h2>
        
        <!-- Masonry сетка для десктопа, горизонтальный скролл для мобильных -->
        <!-- Мобильная версия - горизонтальный скролл -->
        <div class="block sm:hidden">
          <div class="overflow-x-auto hide-scrollbar -mx-4">
            <div class="flex gap-4 px-4 pb-4">
              <div 
                v-for="(image, index) in galleryImages" 
                :key="index"
                class="flex-shrink-0 h-48 overflow-hidden transition-all duration-300 group"
              >
                <img 
                  :src="image" 
                  :alt="`AI Contest Photo ${index + 1}`"
                  class="h-full w-auto max-w-[80vw] object-contain hover:scale-105 transition-transform duration-300 cursor-pointer"
                  @click="openImageModal(image)"
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Десктопная версия - masonry сетка -->
        <div class="hidden sm:block">
          <div class="columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-4 space-y-4">
            <div 
              v-for="(image, index) in galleryImages" 
              :key="index"
              class="break-inside-avoid"
            >
              <img 
                :src="image" 
                :alt="`AI Contest Photo ${index + 1}`"
                class="w-full h-auto rounded-lg shadow-lg hover:shadow-xl transition-shadow duration-300 cursor-pointer"
                @click="openImageModal(image)"
              >
            </div>
          </div>
        </div>
      </section>

      <!-- Секция 8: FAQ -->
      <AiContestFaq />
    </div>
    

    <!-- Модальное окно для просмотра изображений -->
    <div 
      v-if="selectedImage" 
      class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"
      @click="closeImageModal"
    >
      <div class="relative max-w-4xl max-h-full">
        <button 
          @click="closeImageModal"
          class="absolute top-4 right-4 text-white text-2xl font-bold bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-75"
        >
          ×
        </button>
        <img 
          :src="selectedImage" 
          alt="Gallery Image"
          class="max-w-full max-h-full object-contain rounded-lg"
          @click.stop
        >
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted, watch, nextTick } from 'vue'
import AppSeo from '@/components/AppSeo.vue'
import FacesOfEfwSection from '@/components/FacesOfEfwSection.vue'
import AiContestFaq from '@/components/AiContestFaq.vue'

definePageMeta({
  layout: 'default'
})

// Генерируем массив URL изображений от photo-ai-1.png до photo-ai-19.png
const galleryImages = ref([])
const selectedImage = ref(null)
const instagramReels = ref([])
const currentReelIndex = ref(0)
const visibleReels = ref(1)
const currentPage = ref(0)
const autoPlayInterval = ref(null)


// Создаем массив URL для галереи
for (let i = 1; i <= 19; i++) {
  galleryImages.value.push(`https://storage.yandexcloud.net/videos-meyou/efw2025/ai/photo-ai-${i}.png`)
}

// Computed свойства для карусели
const totalPages = computed(() => {
  return Math.ceil(instagramReels.value.length / visibleReels.value)
})

// Функция для определения количества видимых Reels в зависимости от размера экрана (только для десктопа)
const updateVisibleReels = () => {
  if (typeof window !== 'undefined') {
    const width = window.innerWidth
    if (width >= 1024) { // lg и выше - десктоп
      if (width >= 1280) { // xl
        visibleReels.value = 3
      } else { // lg
        visibleReels.value = 2
      }
    } else {
      // Для мобильных и планшетов карусель не используется
      visibleReels.value = 1
    }
  }
}

// Функция для загрузки Instagram Reels из Google Sheets
const fetchInstagramReels = async () => {
  try {
    // Определяем, работаем ли мы локально или на продакшене
    const isLocal = window.location.hostname.includes('localhost') ||
                   window.location.hostname.includes('127.0.0.1') ||
                   window.location.hostname.includes('0.0.0.0');

    if (isLocal) {
      // Локально используем API
      const response = await $fetch('/api/reels', {
        query: { _t: Date.now() } // Добавляем timestamp для предотвращения кеширования
      });
      if (response.success) {
        // Фильтруем только Instagram ссылки
        instagramReels.value = (response.videos || [])
          .filter(url => url.includes('instagram.com/reel/'))
          .filter((url, index, array) => array.indexOf(url) === index); // Убираем дубликаты
        
        console.log('Instagram Reels loaded from API:', instagramReels.value);
      }
    } else {
      // На продакшене (GitHub Pages) используем прямые запросы к Google Sheets
      const SPREADSHEET_ID = '12hBjIa1dMRgX7nVGBMvoAK_1d3Nxl4K-Gi0z9TIB4dQ';
      const CSV_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=0`;

      const response = await fetch(CSV_URL);

      if (!response.ok) {
        throw new Error(`CSV export error: ${response.statusText}`);
      }

      const csvText = await response.text();

      // Парсим CSV правильно (учитывая запятые в кавычках)
      const lines = csvText.split('\n');
      const rows = lines.filter(line => line.trim()).map(line => {
        const values = [];
        let current = '';
        let inQuotes = false;

        for (let i = 0; i < line.length; i++) {
          const char = line[i];

          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            values.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }

        values.push(current.trim());
        return values;
      });

      // Преобразуем в массив ссылок на Instagram Reels
      const allUrls = rows
        .map(row => row[0]?.trim()) // Берем первую колонку
        .filter(url => url && url.startsWith('http')) // Фильтруем только валидные URL
        .map(url => url.replace(/^"(.*)"$/, '$1')) // Убираем кавычки если есть
        .filter((url, index, array) => array.indexOf(url) === index); // Убираем дубликаты

      // Фильтруем только Instagram Reels
      instagramReels.value = allUrls.filter(url => url.includes('instagram.com/reel/'));
    }
    
    console.log('Instagram Reels loaded:', instagramReels.value);
    
    // Принудительно обновляем embed после загрузки данных
    setTimeout(() => {
      if (window.instgrm && window.instgrm.Embeds) {
        console.log('Processing Instagram embeds...');
        window.instgrm.Embeds.process();
      } else {
        console.log('Instagram script not ready, retrying...');
        setTimeout(() => {
          if (window.instgrm && window.instgrm.Embeds) {
            window.instgrm.Embeds.process();
          }
        }, 1000);
      }
    }, 500);
    
  } catch (error) {
    console.error('Error fetching Instagram reels:', error);
    instagramReels.value = [];
  }
};

// Функции для модального окна
const openImageModal = (imageSrc) => {
  selectedImage.value = imageSrc
}

const closeImageModal = () => {
  selectedImage.value = null
}

// Функции для управления каруселью Instagram Reels
const nextReel = () => {
  const maxIndex = Math.max(0, instagramReels.value.length - visibleReels.value)
  console.log('nextReel:', { currentReelIndex: currentReelIndex.value, maxIndex, visibleReels: visibleReels.value, totalReels: instagramReels.value.length })
  
  if (currentReelIndex.value < maxIndex) {
    currentReelIndex.value++
  } else {
    currentReelIndex.value = 0 // Зацикливаем на первый элемент
  }
  currentPage.value = Math.floor(currentReelIndex.value / visibleReels.value)
  console.log('nextReel result:', { currentReelIndex: currentReelIndex.value, currentPage: currentPage.value })
}

const prevReel = () => {
  const maxIndex = Math.max(0, instagramReels.value.length - visibleReels.value)
  if (currentReelIndex.value > 0) {
    currentReelIndex.value--
  } else {
    currentReelIndex.value = maxIndex // Зацикливаем на последний элемент
  }
  currentPage.value = Math.floor(currentReelIndex.value / visibleReels.value)
}

const goToPage = (pageIndex) => {
  currentPage.value = pageIndex
  currentReelIndex.value = pageIndex * visibleReels.value
}

// Функции для автоплея
const startAutoPlay = () => {
  if (instagramReels.value.length > visibleReels.value) {
    autoPlayInterval.value = setInterval(() => {
      nextReel()
    }, 5000) // 5 секунд
  }
}

const stopAutoPlay = () => {
  if (autoPlayInterval.value) {
    clearInterval(autoPlayInterval.value)
    autoPlayInterval.value = null
  }
}



// Watcher для обработки embed при изменении данных
watch(instagramReels, async (newReels) => {
  if (newReels.length > 0) {
    await nextTick();
    setTimeout(() => {
      if (window.instgrm && window.instgrm.Embeds) {
        console.log('Processing Instagram embeds after data change...');
        window.instgrm.Embeds.process();
      }
      
    }, 100);
    
    // Запускаем автоплей после загрузки данных
    startAutoPlay();
  }
}, { deep: true });


// Загружаем Instagram Reels при монтировании компонента
onMounted(() => {
  fetchInstagramReels();
  
  // Инициализируем количество видимых Reels
  updateVisibleReels();
  
  // Добавляем обработчик изменения размера окна
  window.addEventListener('resize', updateVisibleReels);
  
  
  // Загружаем Instagram embed скрипт
  const script = document.createElement('script');
  script.src = '//www.instagram.com/embed.js';
  script.async = true;
  script.onload = () => {
    console.log('Instagram embed script loaded');
    // Принудительно обновляем embed после загрузки скрипта
    if (window.instgrm) {
      window.instgrm.Embeds.process();
    }
    
  };
  script.onerror = () => {
    console.error('Failed to load Instagram embed script');
  };
  document.head.appendChild(script);
  
});

// Очищаем обработчики при размонтировании компонента
onUnmounted(() => {
  // Удаляем обработчик изменения размера окна
  if (typeof window !== 'undefined') {
    window.removeEventListener('resize', updateVisibleReels);
  }
  
  // Останавливаем автоплей
  stopAutoPlay();
});
</script>

<style scoped>
/* Скрытие полосы прокрутки для горизонтального скролла */
.hide-scrollbar {
  scrollbar-width: none;  /* Firefox */
  -ms-overflow-style: none;  /* Internet Explorer 10+ */
}

.hide-scrollbar::-webkit-scrollbar {
  display: none;  /* Safari and Chrome */
}

.Header {
  display: none!important;
}
</style>
